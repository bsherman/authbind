#! /usr/bin/make -f
#   -*- mode: makefile; -*-
#
# Modified by Ian Jackson for authbind.
# Then last updated: Sat Dec 17 10:52:20 EST 1994 by imurdock.
#
# To make the binary distribution package, the ``Debianized'' source package
# and the context diff to the original package, type `./debian.rules dist'.
# Make sure that `debian.rules' is executable before the final distribution
# is made.
#
# Invoke each target with `./debian.rules <target>'.  All targets should be
# invoked with the package root as the current directory.
#
# The `binary' target must be run as root, as it needs to install files with
# specific ownerships.  The `diff' target assumes that you have the original
# source package available, unpacked, in ../$(p)-$(v).orig, or that you have
# the previous revision of the ``Debianized'' source package and context diff
# in the parent directory.

CC = gcc

package=authbind
major=0
minor=1

arch = $(shell dpkg --print-architecture)

build: 
	$(MAKE)

clean:	
	rm -rf debian/{files,substvars,tmp} build 
	$(MAKE) distclean

binary-indep:   checkroot build
        $(checkdir)
# There are no architecture-independent files to be uploaded
# generated by this package.  If there were any they would be
# made here.

lab=libauthbind.so.$(major).$(minor)

binary-arch:	checkroot build
	rm -rf debian/tmp
	install -d -g root -m 755 -o root debian/tmp/DEBIAN \
		debian/tmp/usr/{bin,lib/$(package),doc/$(package)} \
		debian/tmp/etc/authbind/{byport,byname,byuid}
	install -s -g root -o root -m 755 authbind debian/tmp/usr/bin/.
	install -s -g root -o root -m 4755 helper debian/tmp/usr/lib/authbind/.
	install -s -g root -o root -m 755 $(lab) debian/tmp/usr/lib/authbind/.
	ln -s $(lab) debian/tmp/usr/lib/authbind/libauthbind.so.$(major)
	strip --strip-unneeded debian/tmp/usr/lib/authbind/$(lab)
	install -g root -o root -m 644 debian/copyright debian/tmp/usr/doc/$(package)/
	install -g root -o root -m 644 debian/changelog \
		debian/tmp/usr/doc/$(package)/changelog.Debian
	gzip -9 debian/tmp/usr/doc/$(package)/*
ifneq ($(arch),alpha)
	install -g root -o root -m 644 debian/shlibs debian/tmp/DEBIAN
else
	install -g root -o root -m 644 debian/shlibs.alpha debian/tmp/DEBIAN/shlibs
endif
	dpkg-shlibdeps ./authbind
	dpkg-gencontrol
	chown -R root.root debian/tmp
	chmod -R g-ws debian/tmp
	#/bin/bash #-c "ls debian/tmp"
	#bash -c "dpkg --build debian/tmp .."
	dpkg --build debian/tmp ..

binary:	 binary-indep binary-arch

checkroot:
	$(checkdir)
	test root = "`whoami`"
